<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Dashboard - Creato Studios</title>

  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    .toast {
      position: fixed;
      left: 50%;
      transform: translateX(-50%);
      bottom: 24px;
      background: rgba(0,0,0,.85);
      color: #fff;
      padding: 10px 16px;
      border-radius: 8px;
      font-size: 13px;
      z-index: 9999;
    }
  </style>
</head>

<body class="bg-[#050505] text-white">

<div class="flex min-h-screen">

<!-- SIDEBAR -->
<aside class="w-64 border-r border-white/10 p-6">
  <img src="image/image.png" class="h-20 mb-8">

  <button id="overviewTab" class="block mb-4 text-white">Overview</button>
  <button id="campaignTab" class="block text-gray-400">Campaigns</button>

  <div class="mt-10 text-sm">
    <p class="text-gray-400">Influencer ID</p>
    <p id="userIdBox">--</p>

    <p class="mt-3 text-gray-400">Email</p>
    <p id="profileEmail">--</p>

    <p class="mt-4 text-gray-400">Referral Code</p>
    <input id="referralInput" class="w-full bg-[#111] p-2 mt-1" readonly>

    <p class="mt-3 text-gray-400">Referral Link</p>
    <input id="referralLinkInput" class="w-full bg-[#111] p-2 mt-1" readonly>

    <div class="mt-3 grid grid-cols-2 gap-2">
      <button id="waShareBtn" class="bg-green-600 py-2">WhatsApp</button>
      <button id="fbShareBtn" class="bg-blue-600 py-2">Facebook</button>
    </div>
  </div>
</aside>

<!-- MAIN -->
<main class="flex-1 p-8">

<header class="flex justify-between mb-6">
  <h2 class="text-2xl font-bold">Performance Dashboard</h2>
  <button id="logoutBtn" class="bg-red-600 px-4 py-2 rounded">Logout</button>
</header>

<!-- STATS -->
<div class="grid grid-cols-3 gap-6 mb-8">
  <div class="bg-[#111] p-6 rounded">
    <p class="text-gray-400">Clicks</p>
    <h3 id="clicks" class="text-3xl">0</h3>
  </div>
  <div class="bg-[#111] p-6 rounded">
    <p class="text-gray-400">Conversions</p>
    <h3 id="conversions" class="text-3xl">0</h3>
  </div>
  <div class="bg-[#111] p-6 rounded">
    <p class="text-gray-400">Earnings</p>
    <h3 id="earnings" class="text-3xl">₹0</h3>
  </div>
</div>

<!-- JOINED -->
<section id="overviewSection">
  <h3 class="text-xl mb-4">Joined Campaigns</h3>
  <table class="w-full bg-[#111]">
    <thead>
      <tr class="text-gray-400">
        <th class="p-3">Campaign</th>
        <th>Status</th>
        <th>ID</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody id="joinedCampaignsTbody">
      <tr><td class="p-4">Loading...</td></tr>
    </tbody>
  </table>
</section>

<!-- CAMPAIGNS -->
<section id="campaignSection" class="hidden mt-8">
  <h3 class="text-xl mb-4">Available Campaigns</h3>
  <table class="w-full bg-[#111]">
    <thead>
      <tr class="text-gray-400">
        <th class="p-3">Campaign</th>
        <th>Brand</th>
        <th>Status</th>
        <th>Payout</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody id="campaignList">
      <tr><td class="p-4">Loading...</td></tr>
    </tbody>
  </table>
</section>

</main>
</div>

<script>
const API = "https://creatostudiosbackend.vercel.app/v1";
const TOKEN = localStorage.getItem("Bearer");

function toast(msg){
  const t = document.createElement("div");
  t.className="toast";
  t.innerText=msg;
  document.body.appendChild(t);
  setTimeout(()=>t.remove(),2000);
}

async function loadDashboard(){
  const res = await fetch(`${API}/influencer/dashboard`,{
    headers:{Authorization:`Bearer ${TOKEN}`}
  });
  const d = await res.json();

  document.getElementById("userIdBox").innerText = d.id;
  document.getElementById("profileEmail").innerText = d.email;
  document.getElementById("referralInput").value = d.referral_code;
  document.getElementById("referralLinkInput").value =
    `https://lightyellow-butterfly-362806.hostingersite.com/signup.html?ref=${d.referral_code}`;

  document.getElementById("clicks").innerText = d.clicks;
  document.getElementById("conversions").innerText = d.conversions;
  document.getElementById("earnings").innerText = "₹" + (d.conversions * 100);
}

async function loadCampaigns(){
  const res = await fetch(`${API}/campaigns/data`,{
    headers:{Authorization:`Bearer ${TOKEN}`}
  });
  const data = await res.json();

  const tbody = document.getElementById("campaignList");
  tbody.innerHTML = "";

  data.data.forEach(c=>{
    tbody.innerHTML += `
      <tr>
        <td class="p-3">${c.campaign_name}</td>
        <td>${c.brand_name}</td>
        <td>${c.status}</td>
        <td>₹${c.payout || 0}</td>
        <td>
          <a href="${c.campaign_link}" target="_blank"
             class="bg-green-600 px-3 py-1 rounded">
             Visit
          </a>
        </td>
      </tr>
    `;
  });
}

document.getElementById("campaignTab").onclick=()=>{
  document.getElementById("campaignSection").classList.remove("hidden");
  document.getElementById("overviewSection").classList.add("hidden");
  loadCampaigns();
};

document.getElementById("overviewTab").onclick=()=>{
  document.getElementById("overviewSection").classList.remove("hidden");
  document.getElementById("campaignSection").classList.add("hidden");
};

document.getElementById("logoutBtn").onclick=()=>{
  localStorage.removeItem("Bearer");
  location.href="signin.html";
};

loadDashboard();
</script>

</body>
</html>
